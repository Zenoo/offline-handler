const url=new URL(location),parameters=JSON.parse(url.searchParams.get("param"));self.addEventListener("install",e=>{self.skipWaiting(),parameters.clearOldCache&&caches.keys().then(keyList=>{keyList.filter(key=>key!=parameters.version).forEach(key=>{caches.delete(key)})}),e.waitUntil(caches.open(parameters.version).then(cache=>cache.addAll(parameters.ressourceList)))}),self.addEventListener("fetch",e=>{parameters.cacheExternalRequests||e.request.url.startsWith(url.origin)||parameters.ressourceList.includes(e.request.url)?e.respondWith(caches.open(parameters.version).then(cache=>cache.match(e.request).then(resp=>resp||fetch(e.request).then(fetched=>(cache.put(e.request,fetched.clone()),fetched)).catch(()=>caches.match(e.request))))):e.respondWith(fetch(e.request))});